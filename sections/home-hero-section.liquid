{{ 'home-hero-section.css' | asset_url | stylesheet_tag }}

{% assign has_carousel = false %}
{% if section.blocks.size > 0 %}
  {% assign has_carousel = true %}
{% endif %}

{% if has_carousel %}
  <style>
    [data-section="{{ section.id }}"] .swiper-button-next::after,
    [data-section="{{ section.id }}"] .swiper-button-prev::after {
      display: none !important;
    }
    [data-section="{{ section.id }}"] .swiper-button-next,
    [data-section="{{ section.id }}"] .swiper-button-prev {
      height: 30px;
      width: 30px;
    }

    [data-section="{{ section.id }}"] .swiper .swiper-button-next, 
    [data-section="{{ section.id }}"] .swiper .swiper-button-prev {
      top: 50% !important;
      height: 30px;
      width: 30px;
    }

    [data-section="{{ section.id }}"] .home-hero-section .hero-carousel-layout {
      max-height: 100vh;
    }

    
    /* Carousel max height and image sizing */
    [data-section="{{ section.id }}"] .hero-image-swiper .swiper-slide img {
      object-fit: cover;
    }

    [data-section="{{ section.id }}"] .hero-image-swiper .swiper-slide img {
      height: 100% !important;
    }
    
    /* Loading state - entire carousel starts hidden */
    [data-section="{{ section.id }}"] .hero-image-swiper {
      opacity: 0;
      transition: opacity 300ms ease-in-out;
      transition-delay: 500ms;
    }
    
    /* When Swiper is initialized, show carousel */
    [data-section="{{ section.id }}"] .hero-image-swiper.swiper-initialized {
      opacity: 1;
    }
    
    /* Text content transitions */
    [data-section="{{ section.id }}"] .hero-text-item {
      opacity: 0;
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      transition: opacity 300ms ease-in-out;
      pointer-events: none;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
      padding: 60px 40px;
    }
    
    [data-section="{{ section.id }}"] .hero-text-item.active {
      opacity: 1;
      position: relative;
      pointer-events: auto;
    }
    
    [data-section="{{ section.id }}"] .hero-text-column {
      position: relative;
      text-align: center;
    }
    
    [data-section="{{ section.id }}"] .hero-eyebrow {
      margin: 0 0 15px 0 !important;
      color: #000 !important;
      font-family: "Nunito Sans" !important;
      font-size: 20px !important;
      font-style: normal !important;
      font-weight: 600 !important;
      line-height: 150% !important; /* 30px */
      text-transform: uppercase !important;
    }
    
    [data-section="{{ section.id }}"] .hero-title {
      margin: 0 0 20px 0 !important;
      color: #000 !important;
      font-family: "Adobe Caslon Pro" !important;
      font-size: 54px !important;
      font-style: italic !important;
      font-weight: 400 !important;
      line-height: 150% !important; /* 81px */
    }
    
    [data-section="{{ section.id }}"] .hero-subcopy {
      margin: 0 0 20px 0 !important;
      color: #000 !important;
      text-align: center !important;
      font-family: "Nunito Sans" !important;
      font-size: 16px !important;
      font-style: normal !important;
      font-weight: 400 !important;
      line-height: 150% !important; /* 24px */
    }
    
    [data-section="{{ section.id }}"] .hero-text-item .section-button {
      padding-top: 10px;
    }
    
    /* Mobile: remove max-height restrictions */
    @media only screen and (max-width: 749px) {
      [data-section="{{ section.id }}"] .hero-carousel-column,
      [data-section="{{ section.id }}"] .hero-image-swiper,
      [data-section="{{ section.id }}"] .hero-image-swiper .swiper-slide,
      [data-section="{{ section.id }}"] .hero-image-swiper .swiper-slide img {
        max-height: none;
        height: auto;
      }
      [data-section="{{ section.id }}"] .hero-carousel-layout {
        min-height: auto !important;
      }
      
      [data-section="{{ section.id }}"] .hero-text-item {
        padding: 25px 20px;
      }
      
      [data-section="{{ section.id }}"] .hero-title {
        font-size: 30px;
      }
      
      [data-section="{{ section.id }}"] .hero-subcopy {
        font-size: 17px;
        line-height: 1.4;
      }
      
      [data-section="{{ section.id }}"] .hero-text-item .section-button .button {
        font-size: 14px;
        max-width: 165px;
        padding: 11px 10px 9px 10px;
        height: auto;
        min-height: unset;
      }
    }
  </style>
{% endif %}

{%- if has_carousel or section.settings.image != blank or section.settings.video != blank -%}
<div class="section-wrap {% if has_carousel %}has-carousel{% else %}no-abs{% endif %}" data-section="{{ section.id }}">
  
  {% if has_carousel %}
    {%- comment -%} Carousel Layout: Text on Left (35%), Carousel on Right (65%) {%- endcomment -%}
    <div class="hero-carousel-layout">
      
      {%- comment -%} Left Column: Dynamic Text Content from Blocks {%- endcomment -%}
      <div class="hero-text-column text-left text-vertical-center mobile-text-left mobile-text-vertical-bottom" data-hero-text-content>
        {% for block in section.blocks %}
          <div class="hero-text-item {% if forloop.first %}active{% endif %}" data-slide-index="{{ forloop.index0 }}" {{ block.shopify_attributes }}>
            {% if block.settings.eyebrow != blank -%}
              <h4 class="hero-eyebrow">{{ block.settings.eyebrow }}</h4>
            {%- endif -%}
            {%- if block.settings.title != blank -%}
              <h2 class="hero-title">{{ block.settings.title }}</h2>
            {%- endif -%}
            {%- if block.settings.subcopy != blank -%}
              <p class="hero-subcopy">{{ block.settings.subcopy }}</p>
            {%- endif -%}
            {%- if block.settings.button_text != blank and block.settings.button_url != blank -%}
              <div class="section-button">
                <a href="{{ block.settings.button_url }}" class="button button--primary">{{ block.settings.button_text }}</a>
              </div>
            {%- endif -%}
          </div>
        {% endfor %}
      </div>

      {%- comment -%} Right Column: Image Carousel {%- endcomment -%}
      <div class="hero-carousel-column">
        <div class="swiper hero-image-swiper" data-hero-carousel>
          <div class="swiper-wrapper">
            {% for block in section.blocks %}
              <div class="swiper-slide" {{ block.shopify_attributes }}>
                {% if block.settings.image != blank %}
                  <img 
                    src="{{ block.settings.image | img_url: '1800x' }}" 
                    alt="{{ block.settings.image.alt | escape }}"
                    width="{{ block.settings.image.width }}"
                    height="{{ block.settings.image.height }}"
                    loading="{% if forloop.first %}eager{% else %}lazy{% endif %}"
                  >
                {% else %}
                  {{ 'image' | placeholder_svg_tag: 'placeholder-svg' }}
                {% endif %}
              </div>
            {% endfor %}
          </div>
          
          {%- comment -%} Navigation Buttons (Desktop) {%- endcomment -%}
          <button class="swiper-button-prev hero-carousel-prev" aria-label="Previous slide">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M15 18L9 12L15 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </button>
          <button class="swiper-button-next hero-carousel-next" aria-label="Next slide">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M9 18L15 12L9 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </button>
          
          {%- comment -%} Pagination Dots (Mobile) {%- endcomment -%}
          <div class="swiper-pagination hero-carousel-pagination"></div>
        </div>
      </div>

    </div>

    <script>
      document.addEventListener('DOMContentLoaded', function() {
        const heroCarousel = document.querySelector('[data-hero-carousel]');
        const textContent = document.querySelector('[data-hero-text-content]');
        
        if (heroCarousel && textContent && typeof Swiper !== 'undefined') {
          const textItems = textContent.querySelectorAll('.hero-text-item');
          const totalSlides = {{ section.blocks.size | plus: 0 }};
          
          // Function to update text content based on slide index
          function updateTextContent(index) {
            console.log('Updating text to index:', index); // Debug log
            
            // Fade out current active text
            const currentActive = textContent.querySelector('.hero-text-item.active');
            if (currentActive) {
              currentActive.classList.remove('active');
            }
            
            // Fade in new text - ensure index is within bounds
            const targetIndex = index % totalSlides;
            if (textItems[targetIndex]) {
              textItems[targetIndex].classList.add('active');
            }
          }
          
          const swiper = new Swiper(heroCarousel, {
            slidesPerView: 1,
            spaceBetween: 0,
            loop: true,
            speed: 300,
            freeMode: false,
            navigation: {
              nextEl: '.hero-carousel-next',
              prevEl: '.hero-carousel-prev',
            },
            pagination: {
              el: '.hero-carousel-pagination',
              clickable: true,
            },
            breakpoints: {
              750: {
                slidesPerView: 1.3,
                spaceBetween: 15,
              }
            },
            on: {
              ontransitionstart: function() {
                console.log('Slide changed, realIndex:', this.realIndex); 
                updateTextContent(this.realIndex);
              },
            }
          });
        }
      });
    </script>

  {% else %}
    {%- comment -%} Original Single Image/Video Layout {%- endcomment -%}
    {%- if section.settings.link != blank  -%}
      <a href="{{ section.settings.link }}" class="banner-link">
    {% endif %}
      {%- if section.settings.media_type == 'image' -%}
      <div class="section-image flexbox ddd" style="--desktop-image-height:{{ 1 | divided_by: section.settings.image.aspect_ratio | times: 100}}%;--mobile-image-height:{{ 1 | divided_by: section.settings.mobile_image.aspect_ratio | times: 100}}%;">
        <img src="{{ section.settings.image | img_url: '1920x' }}" alt="{{ section.settings.image.alt }}" width="{{ section.settings.image.width }}" height="{{ section.settings.image.height }}"{% if section.settings.mobile_image != blank %} class="small-hide"{% endif %} loading="eager">
        {%- if section.settings.mobile_image != blank -%}
          <img src="{{ section.settings.mobile_image | img_url: '1920x' }}" alt="{{ section.settings.mobile_image.alt }}" width="{{ section.settings.mobile_image.width }}" height="{{ section.settings.mobile_image.height }}" class="medium-hide large-up-hide"  loading="eager">
        {%- endif -%}
      </div>
      {%- elsif section.settings.media_type == 'video' -%}
        <div class="section-image flexbox dd" style="--desktop-image-height:{{ 1 | divided_by: section.settings.video.preview_image.aspect_ratio | times: 100}}%;--mobile-image-height:{{ 1 | divided_by: section.settings.video.preview_image.aspect_ratio | times: 100}}%;">
          <video loop muted playsinline autoplay{% if section.settings.mobile_video != blank %} class="small-hide"{% endif %} >
            <source src="{{ section.settings.video.sources[1].url }}" type="video/mp4">
          </video>
          {%- if section.settings.mobile_video != blank -%}
            <video loop muted playsinline autoplay class="medium-hide large-up-hide">
              <source src="{{ section.settings.mobile_video.sources[1].url }}" type="video/mp4">
            </video>
          {%- endif -%}
        </div>
      {%- endif -%}
    {%- if section.settings.link != blank  -%}
      </a>  
    {% endif %}
    <div class="section-content bottom-content flexbox text-{{ section.settings.text_align }} text-vertical-{{ section.settings.text_vertical_align }} text-horizontal-{{ section.settings.text_horizontal_align }} mobile-text-{{ section.settings.text_align_mobile }} mobile-text-vertical-{{ section.settings.text_vertical_align_mobile }} mobile-text-horizontal-{{ section.settings.text_horizontal_align_mobile }}">

        <div class="content-wrap">
          {% if section.settings.subtitle != blank -%}
            <h4>{{ section.settings.subtitle }}</h4>
          {%- endif -%}
          {%- if section.settings.title != blank -%}

            {% if section.settings.make_h1 %}
                <h1>
              {% else %}
                <h2>
            {% endif %}

              {{ section.settings.title }}

            {% if section.settings.make_h1 %}
                </h1>
              {% else %}
                </h2>
            {% endif %}

          {%- endif -%}
          {%- if section.settings.description != blank -%}
            <p>{{ section.settings.description }}</p>
          {%- endif -%}
          {%- if section.settings.button != blank and section.settings.link != blank and section.settings.button_enable -%}
          <div class="section-button">
            <a href="{{ section.settings.link }}" class="button button--primary">{{ section.settings.button }}</a>
          </div>
          {%- endif -%}
        </div>

    </div>
  {% endif %}

</div>
{%- endif -%}

{%- style -%}
  #shopify-section-{{section.id}} .section-wrap {
    background-color: {{section.settings.section_bg_color}};
  }
  
  #shopify-section-{{section.id}} .section-content h1,
  #shopify-section-{{section.id}} .section-content h2 {
    color:{{section.settings.title_color}};
    font-size: {{section.settings.desktop_font_size}}px !important;
  }
  #shopify-section-{{section.id}} .section-content h4 {
    color:{{section.settings.title_color}};
    margin-bottom: 1rem;
  }
  #shopify-section-{{section.id}} .section-content p{
    color:{{section.settings.description_color}};
  }
  :root #shopify-section-{{section.id}} .section-content .section-button{
    --color-button-text: {{section.settings.button_text_color.red}}, {{section.settings.button_text_color.green}}, {{section.settings.button_text_color.blue}};
    --color-button: {{section.settings.button_bg_color.red}}, {{section.settings.button_bg_color.green}}, {{section.settings.button_bg_color.blue}};
  }

  @media screen and (max-width: 769px) {
    #shopify-section-{{section.id}} .section-content h1,
    #shopify-section-{{section.id}} .section-content h2 {
      font-size: {{section.settings.mobile_font_size}}px !important;
    }
  }
{%- endstyle -%}
{% schema %}
  {
    "name": "Hero section",
    "tag": "section",
    "class": "home-hero-section",
    "settings": [
      {
        "type": "paragraph",
        "content": "Note: If you add carousel image blocks, the section will use carousel mode and ignore the single image/video settings below."
      },
      {
        "type": "color",
        "id": "section_bg_color",
        "label": "Section background color",
        "default": "#FFFBF8"
      },
      {
        "type": "select",
        "id": "media_type",
        "default": "image",
        "label": "Media type",
        "options": [
          {
            "value": "image",
            "label": "Image"
          },
          {
            "value": "video",
            "label": "Video"
          }
        ]
      },
      {
        "type": "image_picker",
        "id": "image",
        "label": "Desktop image"
      },
      {
        "type": "image_picker",
        "id": "mobile_image",
        "label": "Mobile image"
      },
      {
        "type": "video",
        "id": "video",
        "label": "Desktop video"
      },
      {
        "type": "video",
        "id": "mobile_video",
        "label": "Mobile video"
      },
      {
        "type": "select",
        "id": "text_align",
        "default": "left",
        "label": "Text align desktop",
        "options": [
          {
            "value": "left",
            "label": "Left"
          },
          {
            "value": "center",
            "label": "Center"
          },
          {
            "value": "right",
            "label": "Right"
          }
        ]
      },
      {
        "type": "select",
        "id": "text_vertical_align",
        "default": "top",
        "label": "Text vertical align desktop",
        "options": [
          {
            "value": "top",
            "label": "Top"
          },
          {
            "value": "center",
            "label": "Center"
          },
          {
            "value": "bottom",
            "label": "Bottom"
          }
        ]
      },
      {
        "type": "select",
        "id": "text_horizontal_align",
        "default": "left",
        "label": "Text horizontal align desktop",
        "options": [
          {
            "value": "left",
            "label": "Left"
          },
          {
            "value": "center",
            "label": "Center"
          },
          {
            "value": "right",
            "label": "Right"
          }
        ]
      },
      {
        "type": "select",
        "id": "text_align_mobile",
        "default": "left",
        "label": "Text align mobile",
        "options": [
          {
            "value": "left",
            "label": "Left"
          },
          {
            "value": "center",
            "label": "Center"
          },
          {
            "value": "right",
            "label": "Right"
          }
        ]
      },
      {
        "type": "select",
        "id": "text_vertical_align_mobile",
        "default": "bottom",
        "label": "Text vertical align mobile",
        "options": [
          {
            "value": "top",
            "label": "Top"
          },
          {
            "value": "center",
            "label": "Center"
          },
          {
            "value": "bottom",
            "label": "Bottom"
          }
        ]
      },
      {
        "type": "select",
        "id": "text_horizontal_align_mobile",
        "default": "left",
        "label": "Text horizontal align mobile",
        "options": [
          {
            "value": "left",
            "label": "Left"
          },
          {
            "value": "center",
            "label": "Center"
          },
          {
            "value": "right",
            "label": "Right"
          }
        ]
      },
      {
        "type": "text",
        "id": "title",
        "label": "Title"
      },
      {
        "type": "checkbox",
        "id": "make_h1",
        "default": true,
        "label": "Make title an H1 for SEO and fonts",
        "info": "Only one h1 should be used per page for SEO purposes. Enable this only if this is the main hero section of the given page"
      },
      {
        "type": "text",
        "id": "subtitle",
        "label": "Subtitle"
      },
      {
        "type": "number",
        "id": "desktop_font_size",
        "label": "Desktop font size (px)",
        "default": 42
      },
      {
        "type": "number",
        "id": "mobile_font_size",
        "label": "Mobile font size (px)",
        "default": 30
      },
      {
        "type": "color",
        "id": "title_color",
        "label": "Title color"
      },
      {
        "type": "inline_richtext",
        "id": "description",
        "label": "Description"
      },
      {
        "type": "color",
        "id": "description_color",
        "label": "Description color"
      },
      {
        "type": "text",
        "id": "button",
        "label": "Button"
      },
      {
        "type": "checkbox",
        "id": "button_enable",
        "label": "Enable button",
        "default": true
      },
      {
        "type": "url",
        "id": "link",
        "label": "Link"
      },
      {
        "type": "color",
        "id": "button_text_color",
        "label": "Button text color"
      },
      {
        "type": "color",
        "id": "button_bg_color",
        "label": "Button background color"
      }
    ],
    "blocks": [
      {
        "type": "image-carousel-item",
        "name": "Carousel Image",
        "settings": [
          {
            "type": "image_picker",
            "id": "image",
            "label": "Image"
          },
          {
            "type": "text",
            "id": "eyebrow",
            "label": "Eyebrow text",
            "info": "Small text above the title"
          },
          {
            "type": "text",
            "id": "title",
            "label": "Title",
            "default": "Slide Title"
          },
          {
            "type": "textarea",
            "id": "subcopy",
            "label": "Subcopy",
            "info": "Description text below the title"
          },
          {
            "type": "text",
            "id": "button_text",
            "label": "Button text"
          },
          {
            "type": "url",
            "id": "button_url",
            "label": "Button URL"
          }
        ]
      }
    ],
    "presets": [
      {
        "name": "Hero section"
      }
    ]
  }
{% endschema %}